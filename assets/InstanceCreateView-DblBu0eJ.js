import{k as P,j as V,r as F,c as B,l as $,m as u,q as e,v as a,u as t,x as p,z as o,B as v,n as K,C,_ as q,F as G,A as U,G as S,o as O,H as j,I as z,J as H,K as J,E as Q}from"./index-Bxrtyfih.js";import{g as T}from"./index-5KbyUD_j.js";/* empty css                                                                         */const W=[{id:1,name:"image_1"},{id:2,name:"image_2"},{id:3,name:"image_3"},{id:4,name:"image_4"},{id:5,name:"image_5"}],X=[{id:1,name:"flavor_1",description:"description_1",vcpu:1.5,memory:1024,rootDisk:10},{id:2,name:"flavor_2",description:"description_2",vcpu:2,memory:2048,rootDisk:20},{id:3,name:"flavor_3",description:"description_3",vcpu:2.5,memory:3072,rootDisk:30},{id:4,name:"flavor_4",description:"description_4",vcpu:3,memory:4096,rootDisk:40},{id:5,name:"flavor_5",description:"description_5",vcpu:3.5,memory:5120,rootDisk:50}],Y={class:"step-panel"},Z=P({__name:"BasicInfoStep",props:{formData:{},loading:{type:Boolean,default:!1}},emits:["update:form-data","next"],setup(w,{emit:y}){const g=w,d=y,{t:n}=V(),s=F(),l=F(new Set);(async()=>{try{const f=await(await T()).getInstanceList({page:0,size:1e3});l.value=new Set(f.data.map(k=>k.name.toLowerCase()))}catch(_){console.error("Failed to load existing instance names:",_)}})();const r=B(()=>({name:[{required:!0,message:n("message.vm.create.form-name-required")},{min:2,max:50,message:n("message.vm.create.form-name-length")},{validator:(_,f)=>f?/\s/.test(f)?Promise.reject(new Error(n("message.vm.create.form-name-no-whitespace"))):l.value.has(f.toLowerCase())?Promise.reject(new Error(n("message.vm.create.form-name-duplicate"))):Promise.resolve():Promise.resolve()}],description:[{max:80,message:n("message.vm.create.form-description-length")}]})),h=async _=>{const f={...g.formData};f.name=_,d("update:form-data",f),await K(),s.value&&s.value.validateFields(["name"]).catch(()=>{})},i=_=>{const f={...g.formData};f.description=_,d("update:form-data",f)},b=()=>{d("next")};return(_,f)=>{const k=p("a-input"),I=p("a-form-item"),M=p("a-textarea"),N=p("a-button"),x=p("a-form");return C(),$("div",Y,[u("h3",null,a(t(n)("message.vm.create.step-basic")),1),e(x,{ref_key:"formRef",ref:s,model:g.formData,rules:r.value,layout:"vertical",validateTrigger:"input",onFinish:b},{default:o(()=>[e(I,{label:t(n)("message.vm.create.form-name"),name:"name",required:""},{default:o(()=>[e(k,{value:g.formData.name,"onUpdate:value":h,placeholder:t(n)("message.vm.create.form-name-placeholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),e(I,{label:t(n)("message.vm.create.form-description"),name:"description"},{default:o(()=>[e(M,{value:g.formData.description,"onUpdate:value":i,placeholder:t(n)("message.vm.create.form-description-placeholder"),rows:3,maxlength:80,showCount:!0},null,8,["value","placeholder"])]),_:1},8,["label"]),e(I,null,{default:o(()=>[e(N,{type:"primary","html-type":"submit",loading:_.loading},{default:o(()=>[v(a(t(n)("message.vm.create.button-next")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])}}}),ee=q(Z,[["__scopeId","data-v-1adbdda6"]]),ae={class:"step-panel"},te={class:"step-actions"},oe=P({__name:"ImageSelectStep",props:{formData:{},images:{},loading:{type:Boolean,default:!1}},emits:["update:form-data","next","previous"],setup(w,{emit:y}){const g=w,d=y,{t:n}=V(),s=B(()=>[{title:n("message.vm.create.image-id"),dataIndex:"id",key:"id",width:120},{title:n("message.vm.create.image-name"),dataIndex:"name",key:"name"}]),l=r=>{const h={...g.formData};h.sourceId=r[0]||null,d("update:form-data",h)},c=()=>{d("next")};return(r,h)=>{const i=p("a-tag"),b=p("a-table"),_=p("a-button");return C(),$("div",ae,[u("h3",null,a(t(n)("message.vm.create.step-image")),1),e(b,{columns:s.value,"data-source":r.images,pagination:!1,"row-key":"id","row-selection":{type:"radio",selectedRowKeys:r.formData.sourceId?[r.formData.sourceId]:[],onChange:l}},{bodyCell:o(({column:f,record:k})=>[f.key==="id"?(C(),G(i,{key:0},{default:o(()=>[v(a(k.id),1)]),_:2},1024)):U("",!0)]),_:1},8,["columns","data-source","row-selection"]),u("div",te,[e(_,{onClick:h[0]||(h[0]=f=>r.$emit("previous"))},{default:o(()=>[v(a(t(n)("message.vm.create.button-previous")),1)]),_:1}),e(_,{type:"primary",onClick:c,disabled:!r.formData.sourceId,loading:r.loading},{default:o(()=>[v(a(t(n)("message.vm.create.button-next")),1)]),_:1},8,["disabled","loading"])])])}}}),se=q(oe,[["__scopeId","data-v-be6e3738"]]),re={class:"step-panel"},ne={class:"flavor-option"},le={class:"flavor-name"},ce={class:"flavor-specs"},ie={class:"flavor-description"},me={key:0,class:"flavor-summary"},de={class:"step-actions"},ue=P({__name:"FlavorSelectStep",props:{formData:{},flavors:{},loading:{type:Boolean,default:!1}},emits:["update:form-data","next","previous"],setup(w,{expose:y,emit:g}){const d=w,n=g,{t:s}=V(),l=B(()=>d.flavors.map(i=>({value:i.id,label:i.name,description:i.description,vcpu:i.vcpu,memory:i.memory,rootDisk:i.rootDisk}))),c=B(()=>d.flavors.find(i=>i.id===d.formData.flavorId)),r=i=>{const b={...d.formData};b.flavorId=i,n("update:form-data",b)},h=()=>{n("next")};return y({flavorOptions:l}),(i,b)=>{const _=p("a-select"),f=p("a-form-item"),k=p("a-form"),I=p("a-descriptions-item"),M=p("a-descriptions"),N=p("a-button");return C(),$("div",re,[u("h3",null,a(t(s)("message.vm.create.step-flavor")),1),e(k,{layout:"vertical"},{default:o(()=>[e(f,{label:t(s)("message.vm.create.flavor-select"),required:""},{default:o(()=>[e(_,{value:i.formData.flavorId,"onUpdate:value":b[0]||(b[0]=x=>i.formData.flavorId=x),placeholder:t(s)("message.vm.create.flavor-select-placeholder"),options:l.value,onChange:r},{option:o(({label:x,description:m,vcpu:D,memory:A,rootDisk:E})=>[u("div",ne,[u("div",le,a(x),1),u("div",ce," CPU: "+a(D)+" | "+a(t(s)("message.vm.create.flavor-memory"))+": "+a(A)+"MB | "+a(t(s)("message.vm.create.flavor-disk"))+": "+a(E)+"GB ",1),u("div",ie,a(m),1)])]),_:1},8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1}),c.value?(C(),$("div",me,[u("h4",null,a(t(s)("message.vm.create.flavor-selected-info")),1),e(M,{column:1,bordered:""},{default:o(()=>[e(I,{label:t(s)("message.vm.create.flavor-name")},{default:o(()=>[v(a(c.value.name),1)]),_:1},8,["label"]),e(I,{label:t(s)("message.vm.create.flavor-description")},{default:o(()=>[v(a(c.value.description),1)]),_:1},8,["label"]),e(I,{label:t(s)("message.vm.create.flavor-cpu")},{default:o(()=>[v(a(c.value.vcpu)+" vCPU ",1)]),_:1},8,["label"]),e(I,{label:t(s)("message.vm.create.flavor-memory")},{default:o(()=>[v(a(c.value.memory)+" MB ",1)]),_:1},8,["label"]),e(I,{label:t(s)("message.vm.create.flavor-disk")},{default:o(()=>[v(a(c.value.rootDisk)+" GB ",1)]),_:1},8,["label"])]),_:1})])):U("",!0),u("div",de,[e(N,{onClick:b[1]||(b[1]=x=>i.$emit("previous"))},{default:o(()=>[v(a(t(s)("message.vm.create.button-previous")),1)]),_:1}),e(N,{type:"primary",onClick:h,disabled:!i.formData.flavorId,loading:i.loading},{default:o(()=>[v(a(t(s)("message.vm.create.button-next")),1)]),_:1},8,["disabled","loading"])])])}}}),pe=q(ue,[["__scopeId","data-v-9fb14531"]]),ve={class:"step-panel"},_e={class:"final-review"},fe={key:0},ge={class:"flavor-info"},be={class:"flavor-name"},he={class:"flavor-specs"},ye={class:"flavor-description"},Ie={class:"step-actions"},De=P({__name:"ReviewStep",props:{formData:{},images:{},flavors:{},loading:{type:Boolean,default:!1}},emits:["previous","create"],setup(w,{expose:y}){const g=w,{t:d}=V(),n=B(()=>g.images.find(l=>l.id===g.formData.sourceId)),s=B(()=>g.flavors.find(l=>l.id===g.formData.flavorId));return y({selectedImage:n,selectedFlavor:s}),(l,c)=>{const r=p("a-descriptions-item"),h=p("a-tag"),i=p("a-descriptions"),b=p("a-button");return C(),$("div",ve,[u("h3",null,a(t(d)("message.vm.create.review-title")),1),u("div",_e,[e(i,{column:1,bordered:""},{default:o(()=>[e(r,{label:t(d)("message.vm.create.review-instance-name")},{default:o(()=>[v(a(l.formData.name),1)]),_:1},8,["label"]),e(r,{label:t(d)("message.vm.create.review-description")},{default:o(()=>[v(a(l.formData.description||t(d)("message.vm.create.review-no-description")),1)]),_:1},8,["label"]),e(r,{label:t(d)("message.vm.create.review-image")},{default:o(()=>{var _;return[v(a((_=n.value)==null?void 0:_.name),1)]}),_:1},8,["label"]),e(r,{label:t(d)("message.vm.create.review-flavor")},{default:o(()=>[s.value?(C(),$("div",fe,[u("div",ge,[u("div",be,a(s.value.name),1),u("div",he,[e(h,{color:"blue"},{default:o(()=>[v(a(s.value.vcpu)+" vCPU",1)]),_:1}),e(h,{color:"green"},{default:o(()=>[v(a(s.value.memory)+" MB",1)]),_:1}),e(h,{color:"orange"},{default:o(()=>[v(a(s.value.rootDisk)+" GB",1)]),_:1})]),u("div",ye,a(s.value.description),1)])])):U("",!0)]),_:1},8,["label"])]),_:1})]),u("div",Ie,[e(b,{onClick:c[0]||(c[0]=_=>l.$emit("previous"))},{default:o(()=>[v(a(t(d)("message.vm.create.button-previous")),1)]),_:1}),e(b,{type:"primary",onClick:c[1]||(c[1]=_=>l.$emit("create")),loading:l.loading},{default:o(()=>[v(a(t(d)("message.vm.create.button-create")),1)]),_:1},8,["loading"])])])}}}),Ce=q(De,[["__scopeId","data-v-e453bbf6"]]),ke={class:"vm-instance-create"},we={class:"step-content"},$e=P({__name:"VmInstanceCreate",setup(w,{expose:y}){const g=[{component:ee,title:"message.vm.create.step-basic"},{component:se,title:"message.vm.create.step-image"},{component:pe,title:"message.vm.create.step-flavor"},{component:Ce,title:"message.vm.create.step-confirm"}],d=B(()=>{var m;return(m=g[r.value])==null?void 0:m.component}),n=B(()=>{const m={loading:h.value};switch(r.value){case 1:return{...m,images:i.value};case 2:return{...m,flavors:b.value};case 3:return{...m,images:i.value,flavors:b.value};default:return m}});S.config({top:"70px"});const s=Q(),{t:l}=V(),c=F({name:"",description:"",host:"",flavorId:null,sourceType:"IMAGE",sourceId:null}),r=F(0),h=F(!1),i=F([]),b=F([]);O(()=>{_()});const _=()=>{i.value=W,b.value=X},f=[()=>!0,()=>c.value.name.trim()?!0:(S.error(l("message.vm.create.form-name-required")),!1),()=>c.value.sourceId?!0:(S.error(l("message.vm.create.error-image-required")),!1),()=>c.value.flavorId?!0:(S.error(l("message.vm.create.error-flavor-required")),!1)],k=m=>{for(let D=1;D<=m;D++)if(f[D]&&!f[D]())return!1;return!0},I=m=>{if(m<r.value){r.value=m;return}m>r.value&&k(m)&&(r.value=m)},M=()=>{const m=r.value+1;k(m)&&(r.value=m)},N=()=>{r.value>0&&r.value--},x=async()=>{if(!c.value.sourceId){S.error(l("message.vm.create.error-image-required"));return}if(!c.value.flavorId){S.error(l("message.vm.create.error-flavor-required"));return}h.value=!0;try{const m=await T(),D=`192.168.1.${Math.floor(Math.random()*254)+1}`,A=await m.createInstance({name:c.value.name,description:c.value.description,host:D,flavorId:c.value.flavorId,sourceType:c.value.sourceType,sourceId:c.value.sourceId});S.success(l("message.vm.create.success-created")),s.push(`/servers/instances/${A.id}`)}catch(m){console.error("인스턴스 생성 실패:",m),S.error(l("message.vm.create.error-create-failed"))}finally{h.value=!1}};return y({currentStep:r,formData:c}),(m,D)=>{const A=p("a-step"),E=p("a-steps");return C(),$("div",ke,[e(E,{current:r.value,class:"create-steps",onChange:I},{default:o(()=>[(C(),$(j,null,z(g,(R,L)=>e(A,{key:L,title:t(l)(R.title)},null,8,["title"])),64))]),_:1},8,["current"]),u("div",we,[(C(),G(J(d.value),H({"form-data":c.value,"onUpdate:formData":D[0]||(D[0]=R=>c.value=R)},n.value,{onNext:M,onPrevious:N,onCreate:x}),null,16,["form-data"]))])])}}}),xe=q($e,[["__scopeId","data-v-533d90be"]]),Se={class:"instance-create-view"},Be={class:"page-header"},Fe={class:"page-title"},Ne={class:"page-content"},Pe=P({__name:"InstanceCreateView",setup(w){const{t:y}=V();return(g,d)=>{const n=p("a-breadcrumb-item"),s=p("router-link"),l=p("a-breadcrumb");return C(),$("div",Se,[u("div",Be,[e(l,null,{default:o(()=>[e(n,null,{default:o(()=>[v(a(t(y)("message.vm.instance.breadcrumb-server")),1)]),_:1}),e(n,null,{default:o(()=>[e(s,{to:"/servers/instances"},{default:o(()=>[v(a(t(y)("message.vm.instance.breadcrumb-instance")),1)]),_:1})]),_:1}),e(n,null,{default:o(()=>[v(a(t(y)("message.vm.instance.breadcrumb-create")),1)]),_:1})]),_:1}),u("div",Fe,[u("h1",null,a(t(y)("message.vm.create.page-title")),1),u("p",null,a(t(y)("message.vm.create.page-description")),1)])]),u("div",Ne,[e(xe)])])}}}),Ae=q(Pe,[["__scopeId","data-v-b78c16fc"]]);export{Ae as default};
