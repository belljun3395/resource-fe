import{q as s,L as z,M as F,k as O,j as I,G as b,l as U,x as m,z as i,u as o,B as f,v as u,C,_ as A,c as x,F as M,m as P,r as S,o as q,N as H,E as W}from"./index-Bxrtyfih.js";import{I as E,a as j,g as J}from"./VmListTable.vue_vue_type_style_index_0_scoped_0d5b3520_lang-CJl_cmLx.js";import{g as k}from"./index-5KbyUD_j.js";/* empty css                                                                         */function B(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},a=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),a.forEach(function(n){Q(l,n,t[n])})}return l}function Q(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}var h=function(e,t){var a=B({},e,t.attrs);return s(E,B({},a,{icon:z}),null)};h.displayName="CopyOutlined";h.inheritAttrs=!1;function T(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},a=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),a.forEach(function(n){X(l,n,t[n])})}return l}function X(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}var $=function(e,t){var a=T({},e,t.attrs);return s(E,T({},a,{icon:F}),null)};$.displayName="DownOutlined";$.inheritAttrs=!1;const Y={class:"detail-section","data-testid":"vm-instance-details"},Z=O({__name:"VmInstanceDetails",props:{instanceDetails:{}},setup(l){const{t:e}=I();b.config({maxCount:1,duration:2});const t=(a,n)=>{navigator.clipboard.writeText(a).then(()=>{b.success({content:e("message.vm.instance.copy-success",{label:n}),style:{marginTop:"100px"}})}).catch(c=>{b.error({content:e("message.vm.instance.copy-error",{error:c}),style:{marginTop:"100px"}})})};return(a,n)=>{const c=m("a-descriptions-item"),g=m("a-button"),v=m("a-tag"),d=m("a-descriptions");return C(),U("div",Y,[s(d,{column:1,bordered:""},{default:i(()=>[s(c,{label:o(e)("message.vm.instance.label-name")},{default:i(()=>[f(u(a.instanceDetails.name),1)]),_:1},8,["label"]),s(c,{label:o(e)("message.vm.instance.label-id")},{default:i(()=>[f(u(a.instanceDetails.id)+" ",1),s(g,{type:"text",size:"small",class:"copy-btn",onClick:n[0]||(n[0]=_=>t(a.instanceDetails.id,o(e)("message.vm.instance.label-id")))},{default:i(()=>[s(o(h))]),_:1})]),_:1},8,["label"]),s(c,{label:o(e)("message.vm.instance.label-power-state")},{default:i(()=>[s(v,{color:"green"},{default:i(()=>[f(u(a.instanceDetails.powerState),1)]),_:1})]),_:1},8,["label"]),s(c,{label:o(e)("message.vm.instance.label-alias")},{default:i(()=>[f(u(a.instanceDetails.alias)+" ",1),s(g,{type:"text",size:"small",class:"copy-btn",onClick:n[1]||(n[1]=_=>t(a.instanceDetails.alias,o(e)("message.vm.instance.label-alias")))},{default:i(()=>[s(o(h))]),_:1})]),_:1},8,["label"]),s(c,{label:o(e)("message.vm.instance.label-host")},{default:i(()=>[f(u(a.instanceDetails.host),1)]),_:1},8,["label"])]),_:1})])}}}),K=A(Z,[["__scopeId","data-v-41d2beb8"]]),ee={class:"delete-warning"},te=O({__name:"DeleteConfirmModal",props:{open:{type:Boolean},instanceName:{},loading:{type:Boolean,default:!1}},emits:["update:open","confirm","cancel"],setup(l,{emit:e}){const t=l,a=e,{t:n}=I(),c=x({get:()=>t.open,set:d=>a("update:open",d)}),g=()=>{a("confirm")},v=()=>{a("cancel"),a("update:open",!1)};return(d,_)=>{const y=m("a-modal");return C(),M(y,{open:c.value,"onUpdate:open":_[0]||(_[0]=w=>c.value=w),title:o(n)("message.vm.instance.delete-confirm-title"),"confirm-loading":d.loading,"ok-text":o(n)("message.vm.instance.delete-ok"),"cancel-text":o(n)("message.vm.instance.delete-cancel"),"ok-type":"danger",keyboard:!0,"mask-closable":!0,onOk:g,onCancel:v},{default:i(()=>[P("p",null,u(o(n)("message.vm.instance.delete-confirm-message",{name:d.instanceName})),1),P("p",ee,u(o(n)("message.vm.instance.delete-warning")),1)]),_:1},8,["open","title","confirm-loading","ok-text","cancel-text"])}}}),ae=A(te,[["__scopeId","data-v-9a3eaf12"]]),ne=O({__name:"VmInstancePowerStatusDropdown",props:{powerState:{},instanceId:{},loading:{type:Boolean}},emits:["powerStatusChange"],setup(l,{emit:e}){const{t}=I(),a=l,n=e,c=S(!1),g=x(()=>a.loading??c.value),v=async d=>{const _=d.key;a.loading===void 0&&(c.value=!0);try{n("powerStatusChange",_),a.loading===void 0&&await new Promise(y=>setTimeout(y,100))}finally{a.loading===void 0&&(c.value=!1)}};return(d,_)=>{const y=m("a-button"),w=m("a-menu-item"),p=m("a-menu"),r=m("a-dropdown");return C(),M(r,{trigger:["click"]},{overlay:i(()=>[s(p,{onClick:v},{default:i(()=>[s(w,{key:"start",disabled:d.powerState==="RUNNING"},{default:i(()=>[f(u(o(t)("message.vm.instance.action-start")),1)]),_:1},8,["disabled"]),s(w,{key:"shutdown",disabled:d.powerState==="SHUTDOWN"},{default:i(()=>[f(u(o(t)("message.vm.instance.action-shutdown")),1)]),_:1},8,["disabled"]),s(w,{key:"reboot",disabled:d.powerState!=="RUNNING"},{default:i(()=>[f(u(o(t)("message.vm.instance.action-reboot")),1)]),_:1},8,["disabled"]),s(w,{key:"pause",disabled:d.powerState!=="RUNNING"},{default:i(()=>[f(u(o(t)("message.vm.instance.action-pause")),1)]),_:1},8,["disabled"])]),_:1})]),default:i(()=>[s(y,{type:"primary",loading:g.value},{default:i(()=>[f(u(o(t)("message.vm.instance.power-status-dropdown"))+" ",1),s(o($))]),_:1},8,["loading"])]),_:1})}}}),se={class:"instance-detail-view"},oe={class:"detail-content-wrapper"},ie=O({__name:"InstanceDetailView",props:{instanceId:{}},setup(l){const e=l,{t}=I(),a=W(),n=S(new j({name:"",id:e.instanceId,powerState:"NOSTATE",alias:"",host:""})),c=S(!0),g=S(!1),v=S(!1),d=S(!1),_=async()=>{try{const r=await(await k()).getInstance(e.instanceId);n.value=new j({name:r.name,id:r.id.toString(),powerState:r.powerStatus,alias:r.alias,host:r.host})}catch(p){console.error("Failed to load instance data:",p)}finally{c.value=!1}},y=async p=>{g.value=!0;const r=b.loading(t("message.vm.instance.action-in-progress",{action:p}),0);try{const D=await k(),N=J(p);await D.updatePowerStatus(e.instanceId,N),r(),b.success(t("message.vm.instance.action-success",{action:p})),await _()}catch(D){console.error("Failed to update power status:",D),r(),b.error(t("message.vm.instance.action-error"))}finally{g.value=!1}},w=async()=>{try{d.value=!0;const r=await(await k()).deleteInstance(e.instanceId);r.isDeleted&&r.isAccepted?(b.success(t("message.vm.instance.delete-success",{name:n.value.name})),await a.push("/servers/instances")):b.error(t("message.vm.instance.delete-failed"))}catch(p){b.error(t("message.vm.instance.delete-error")),console.error("Failed to delete instance:",p)}finally{d.value=!1,v.value=!1}};return q(()=>{_()}),(p,r)=>{const D=m("a-breadcrumb-item"),N=m("router-link"),G=m("a-breadcrumb"),L=m("a-button"),R=m("a-page-header");return C(),U("div",se,[s(R,{title:c.value?o(t)("message.vm.instance.loading"):n.value.name,onBack:r[1]||(r[1]=()=>p.$router.push("/servers/instances"))},{breadcrumb:i(()=>[s(G,null,{default:i(()=>[s(D,null,{default:i(()=>[f(u(o(t)("message.vm.instance.breadcrumb-server")),1)]),_:1}),s(D,null,{default:i(()=>[s(N,{to:"/servers/instances"},{default:i(()=>[f(u(o(t)("message.vm.instance.breadcrumb-instance")),1)]),_:1})]),_:1})]),_:1})]),extra:i(()=>[s(o(ne),{powerState:n.value.powerState,instanceId:e.instanceId,loading:g.value,onPowerStatusChange:y},null,8,["powerState","instanceId","loading"]),s(L,{key:"delete",danger:"",disabled:n.value.powerState==="RUNNING",onClick:r[0]||(r[0]=V=>v.value=!0)},{default:i(()=>[f(u(o(t)("message.vm.instance.button-delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title"]),P("div",oe,[s(o(K),{instanceDetails:n.value,class:H({loading:c.value})},null,8,["instanceDetails","class"])]),s(o(ae),{open:v.value,"onUpdate:open":r[2]||(r[2]=V=>v.value=V),"instance-name":n.value.name,loading:d.value,onConfirm:w},null,8,["open","instance-name","loading"])])}}}),ue=A(ie,[["__scopeId","data-v-fd0b0b1e"]]);export{ue as default};
